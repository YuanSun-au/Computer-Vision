clear all; close all; clc;

%% C)

f = [0 0 0 0 0;
     0 0 0 0 0;
     5 5 0 0 0;
     5 5 0 0 0;
     5 5 0 0 0]

fx = conv2(f(2:end-1,:), [1 0 -1]/2, 'valid')
fy = conv2(f(:,2:end-1), [1 0 -1]'/2, 'valid')
 
for i=1:3
    for j=1:3
        J0{j,i} = [ fx(j,i)^2,       fx(j,i)*fy(j,i); 
                    fx(j,i)*fy(j,i), fy(j,i)^2 ];
        eigJ0{j,i} = eig(J0{j,i});
    end
end


%% D)

gausk = [1/16 1/8 1/16;
          1/8 1/4 1/8;
          1/16 1/8 1/16]

fx2 = cellfun( @(f) f(1,1)^2, J0 )
      
[EIGV,EIG] = eig(J0{2,2})    
J0_filterd = conv2(gausk,J0{2,2},'valid')

% new eigenvalues and eigenvectors after convolution
[EIGV,EIG] = eig(J0_filterd)


%% E) F) H)
img = zeros(3,3,2);
img(:,:,1) = [5 5 0; 5 5 0; 5 5 0];
img(:,:,2) = [0 0 5;0 0 5;0 0 5];
img(:,:,3) = zeros(3);

fx = imfilter(img,[-1 0 1]/2);
fy = imfilter(img,[-1 0 1]'/2);

dfR = [fx(2,2,1),fy(2,2,1)]'
dfG = [fx(2,2,2),fy(2,2,2)]'
dfB = [fx(2,2,3),fy(2,2,3)]'

% E)
norm( dfR + dfG + dfB )
% F)
norm( [norm(dfR) norm(dfG) norm(dfB) ] )
% H)
[EIGV,EIG] = eig( dfR*dfR' + dfG*dfG' + dfB*dfB' )